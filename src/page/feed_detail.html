<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detail Postingan - EcoWaste Connect</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Poppins:wght@400;600;700&display=swap"
    rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', 'Segoe UI', sans-serif;
      color: #1f2937;
      background-color: #f0fdf4;
      /* Pale Green */
    }

    .font-lora {
      font-family: 'Lora', serif;
    }

    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 50;
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
  </style>
  <link rel="stylesheet" crossorigin href="../../assets/css/sampah_kita.css">
</head>

<body>
  <header id="navbar-sk" class="sticky-header top-0 z-50 bg-white/80 backdrop-blur-sm shadow-sm">

  </header>

  <main class="max-w-5xl mx-auto px-4 py-12 md:py-16">
    <a href="feed.html" class="inline-flex items-center gap-2 text-green-600 hover:text-green-700 font-semibold mb-6">
      <i class="fas fa-arrow-left"></i> Kembali ke Feed
    </a>

    <article class="bg-white rounded-2xl shadow-lg p-6 md:p-8 border border-gray-100 mb-10">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <img id="feed-profile"
            src="https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?ixlib=rb-4.0.3&q=85&fm=jpg&crop=entropy&cs=srgb&w=800"
            alt="Profil Pengguna" class="w-12 h-12 rounded-full object-cover" />
          <div>
            <p id="feed-name" class="font-semibold text-gray-800"></p>
          </div>
        </div>
        <span id="feed-time" class="text-sm text-gray-400"></span>
      </div>

      <p id="feed-content" class="text-gray-700 leading-relaxed mb-4">
      </p>

      <img
        src="https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?ixlib=rb-4.0.3&q=85&fm=jpg&crop=entropy&cs=srgb&w=800"
        alt="Postingan Sampah" class="w-full h-auto rounded-lg mb-4 object-cover max-h-[500px] border" />

      <div class="flex justify-between items-center text-gray-600 pt-4 border-t border-gray-100">
        <div class="flex gap-6">
          <button class="flex items-center gap-2 hover:text-green-600 transition text-lg">
            <i class="far fa-heart"></i>
            <span id="feed-total-likes" class="text-sm font-semibold">25</span>
          </button>
          <button class="flex items-center gap-2 hover:text-green-600 transition text-lg">
            <i class="far fa-comment"></i>
            <span id="feed-total-comments" class="text-sm font-semibold">8</span>
          </button>
        </div>
        <button class="flex items-center gap-2 hover:text-green-600 transition text-lg">
          <i class="fas fa-share-alt"></i>
          <span class="text-sm font-semibold">Bagikan</span>
        </button>
      </div>
    </article>

    <section>
      <h2 id="feed-total-comments-2" class="font-lora text-2xl font-bold text-gray-800 mb-6">
        Komentar (8)
      </h2>

      <div class="flex items-start gap-4 mb-8">
        <img id="profile-picture" src="https://images.unsplash.com/photo-153571387500-b6f7051e6e0d?q=80&w=400"
          alt="Avatar Anda" class="w-10 h-10 rounded-full object-cover flex-shrink-0 mt-1" />
        <div class="flex-grow">
          <textarea id="text-create" rows="3"
            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none resize-none mb-3"
            placeholder="Tulis komentar Anda..."></textarea>
          <button onclick="create_comment()"
            class="px-5 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold float-right">
            Kirim Komentar
          </button>
        </div>
      </div>

      <div id="comment-container">


      </div>
    </section>
  </main>

  <footer class="bg-gray-900 text-white pt-16 pb-8 mt-16">
    <div class="max-w-7xl mx-auto px-4">
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12 text-center md:text-left">
        <div class="md:col-span-2 lg:col-span-1">
          <div class="flex items-center justify-center md:justify-start gap-2 mb-4">
            <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
              <i class="fas fa-leaf"></i>
            </div>
            <span class="text-2xl font-bold">EcoWaste</span>
          </div>
          <p class="text-gray-400 text-sm">
            Platform digital untuk manajemen sampah yang efisien dan
            berkelanjutan.
          </p>
        </div>
        <div>
          <h4 class="text-lg font-bold mb-4">Halaman</h4>
          <ul class="space-y-2 text-gray-400 font-semibold">
            <li>
              <a href="#" class="hover:text-green-400 transition">Bank Sampah</a>
            </li>
            <li>
              <a href="feed.html" class="hover:text-green-400 transition">Feed</a>
            </li>
            <li>
              <a href="leaderboard.html" class="hover:text-green-400 transition">Leaderboard</a>
            </li>
            <li>
              <a href="src/page/about_us.html" class="hover:text-green-400 transition">Tentang Kami</a>
            </li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-bold mb-4">Hubungi Kami</h4>
          <ul class="space-y-2 text-gray-400 font-semibold">
            <li>
              <a href="mailto:info@ecowaste.com" class="hover:text-green-400 transition">info@ecowaste.com</a>
            </li>
            <li>
              <a href="tel:+62123456789" class="hover:text-green-400 transition">+62 123 4567 890</a>
            </li>
            <li class="text-sm">Jl. Hijau No. 123, Semarang</li>
          </ul>
        </div>
        <div>
          <h4 class="text-lg font-bold mb-4">Ikuti Kami</h4>
          <div class="flex gap-4 justify-center md:justify-start">
            <a href="#"
              class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-green-500 transition"><i
                class="fab fa-instagram"></i></a><a href="#"
              class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-green-500 transition"><i
                class="fab fa-facebook"></i></a><a href="#"
              class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-green-500 transition"><i
                class="fab fa-twitter"></i></a><a href="#"
              class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-green-500 transition"><i
                class="fab fa-youtube"></i></a>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-800 pt-8 text-center text-gray-400">
        <p>&copy; 2025 EcoWaste Connect. All Rights Reserved.</p>
      </div>
    </div>
  </footer>
  <script src="../../assets/js/sampahkita_main.js"></script>
  <script>
    const params = new URLSearchParams(window.location.search);
    const post_id = params.get("feed_id");
    console.log(post_id)
    function check_session(){
    fetch(`../../api/session_info`)
      .then(response => response.json())
      .then(sessions => {
        if (sessions.status == "sukses") {
          window.location.href = `feed_detail?feed_id=${post_id}`;
        } else {
          window.location.href = "login";
        }

      })
    }
    check_session()

    function load_profile() {
      fetch("../../api/user_profile")
        .then(response => response.json())
        .then(data_profile => {
          console.log(data_profile);
          if (data_profile.status == "sukses") {
            profile_picture = document.getElementById("profile-picture");
            profile_name = document.getElementById("profile-name");

            profile_picture.src = `https://api.dicebear.com/9.x/initials/svg?seed=${data_profile.fullname}&size=128`;
            profile_name.innerText = data_profile.fullname;
          }
        })
    }
    load_profile();

    function load_post(i) {
      fetch(`../../api/load_feed?feed_id=${i}`)
        .then(response => response.json())
        .then(data_feed => {
          feed_profile = document.getElementById("feed-profile");
          feed_name = document.getElementById("feed-name");
          feed_content = document.getElementById("feed-content");
          feed_time = document.getElementById("feed-time");
          feed_total_likes = document.getElementById("feed-total-likes");
          feed_total_comments = document.getElementById("feed-total-comments");
          feed_total_comments_2 = document.getElementById("feed-total-comments-2");

          feed_profile.src = `https://api.dicebear.com/9.x/initials/svg?seed=${data_feed.feed.fullname}&size=128`;
          feed_name.innerText = data_feed.feed.fullname;
          feed_content.innerText = data_feed.feed.content;
          feed_time.innerText = timeAgo(data_feed.feed.publish_at);
          feed_total_likes.innerText = data_feed.feed.total_likes;
          feed_total_comments.innerText = data_feed.feed.total_comments;
          feed_total_comments_2.innerText = `Komentar (${data_feed.feed.total_comments})`;

          const container = document.getElementById("comment-container");
          container.innerHTML = "";
          data_feed.comments.forEach((comment) => {
            const div = document.createElement("div");
            div.innerHTML = `
            <div class="space-y-6">
            <div class="flex items-start gap-4">
              <img src="https://api.dicebear.com/9.x/initials/svg?seed=${comment.fullname}" alt="Avatar Komentator"
                class="w-10 h-10 rounded-full object-cover flex-shrink-0" />
              <div class="flex-grow shadow bg-white p-4 rounded-lg border border-gray-100">
                <div class="flex justify-between items-center mb-1">
                  <span class="font-semibold text-gray-800">${comment.fullname}</span>
                  <span class="text-xs text-gray-400">${timeAgo(comment.commented_at)}</span>
                </div>
                <p class="text-gray-600 text-sm">
                  ${comment.content}
                </p>
              </div>
            </div>
            `;
            container.appendChild(div);

          });
        })
    }
    load_post(post_id)

    function timeAgo(datetime) {
      const now = new Date();
      const then = new Date(datetime);
      const diffMs = now - then;

      const seconds = Math.floor(diffMs / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);

      if (seconds < 60) return "Baru saja";
      if (minutes < 60) return `${minutes} menit yang lalu`;
      if (hours < 24) return `${hours} jam yang lalu`;
      if (days < 7) return `${days} hari yang lalu`;
      if (days < 30) return `${Math.floor(days / 7)} minggu yang lalu`;
      if (days < 365) return `${Math.floor(days / 30)} bulan yang lalu`;
      return `${Math.floor(days / 365)} tahun yang lalu`;
    }

    async function create_comment() {
      const text_comment = document.getElementById('text-create').value;
      console.log(text_comment);
      const data_form = {
        feed_id: post_id,
        komentar: text_comment
      };

      try {
        const response = await fetch('../../api/feed_comment', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data_form)
        });

        const resp = await response.text();
        console.log(resp);


        if (resp) {
          location.reload();
          console.log("Respon : " + resp.message)
        }
      } catch (err) {
        console.error('Error:', err);
      }
    }
  </script>
</body>

</html>