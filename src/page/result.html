<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hasil Scan Sampah - SampahKita</title>
  <link rel="icon" type="image/png" href="../../assets/img/logo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Poppins:wght@400;600;700&display=swap"
    rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <link rel="stylesheet" href="../../assets/css/sampah_kita.css">
  <style>
    body {
      font-family: "Poppins", "Segoe UI", sans-serif;
      color: #1f2937;
      background-color: #f0fdf4;
    }

    .font-lora {
      font-family: "Lora", serif;
    }

    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 50;
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .upload-box {
      border: 3px dashed #a7f3d0;
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .upload-box:hover {
      background-color: #d1fae5;
      border-color: #6ee7b7;
    }

    /* Spinner untuk loading deteksi */
    .spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #22c55e;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <header id="navbar-sk" class="sticky-header top-0 z-50 bg-white/80 backdrop-blur-sm shadow-sm">

  </header>

  <main class="max-w-7xl mx-auto px-4 py-12 md:py-16">
    <div class="grid lg:grid-cols-3 gap-8 md:gap-12">
      <div class="lg:col-span-1">
        <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 sticky top-24">
          <h2 class="font-bold text-lg text-gray-800 mb-4">Gambar Anda</h2>
          <img id="scanned-image" src="#" alt="Gambar Sampah yang di-Scan"
            class="w-full h-auto object-contain rounded-lg" />
        </div>
      </div>

      <div class="lg:col-span-2">
        <p class="text-base font-semibold text-gray-500 tracking-wider">
          HASIL DETEKSI
        </p>
        <h1 id="waste-type" class="font-lora text-4xl lg:text-5xl font-bold text-green-800 mt-2"></h1>
        <div id="confidence-score"
          class="inline-block mt-4 px-4 py-1 bg-green-100 text-green-800 text-sm font-bold rounded-full"></div>

        <hr class="my-8 border-gray-200" />

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <div>
            <div class="flex items-center gap-3 mb-2">
              <i class="fas fa-recycle text-xl text-green-500"></i>
              <h3 class="font-bold text-gray-500">Dapat Didaur Ulang?</h3>
            </div>
            <p id="recyclable-status" class="text-xl font-semibold text-gray-800"></p>
          </div>
          <div>
            <div class="flex items-center gap-3 mb-2">
              <i class="fas fa-leaf text-xl text-green-500"></i>
              <h3 class="font-bold text-gray-500">Jejak Karbon</h3>
            </div>
            <p id="carbon-fact" class="text-gray-600"></p>
          </div>
        </div>

        <hr class="my-8 border-gray-200" />

        <div class="bg-green-50/50 p-6 rounded-xl border-l-4 border-green-300">
          <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center gap-3">
            <i class="fas fa-lightbulb text-yellow-400 text-2xl"></i>Info
            Penting
          </h3>
          <p id="education-info" class="text-gray-600 leading-relaxed"></p>
        </div>

        <div class="mt-10">
          <a href="bank_sampah.html" id="dispose-button"
            class="w-full flex items-center justify-center gap-3 px-8 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1">
            <i class="fas fa-map-marker-alt"></i>
            <span>Temukan Lokasi Buang Sampah</span>
          </a>
          <div class="text-center mt-4">
            <a href="scan.html" class="text-green-600 font-semibold hover:underline">
              <i class="fas fa-camera mr-1"></i> Scan Gambar Lain
            </a>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script src="../../assets/js/sampahkita.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {

      const imageData = sessionStorage.getItem('scannedImage');
      const scannedImageEl = document.getElementById('scanned-image');

      if (imageData && scannedImageEl) {
        scannedImageEl.src = imageData;
      }

      const urlParams = new URLSearchParams(window.location.search);
      const wasteClass = urlParams.get('class'); 


      loadWasteData(wasteClass);
    });

    async function loadWasteData(wasteClass) {
      const mainElement = document.querySelector('main');

      if (!wasteClass) {
        mainElement.innerHTML = `<div class="text-center"><h1 class="font-lora text-3xl font-bold text-red-600">Error: Jenis Sampah Tidak Dikenali</h1><p class="text-gray-600 mt-4">Parameter 'class' tidak ditemukan. Silakan scan ulang.</p><a href="scan.html" class="mt-8 inline-block px-6 py-3 bg-green-600 text-white rounded-lg">Coba Scan Lagi</a></div>`;
        return;
      }
      const data = await getDynamicWasteData(wasteClass);

      if (data) {
        document.getElementById('waste-type').textContent = data.type;
        document.getElementById(
          'confidence-score'
        ).textContent = `Akurasi Deteksi: ${data.confidence}`;
        document.getElementById('recyclable-status').textContent =
          data.recyclable;
        document.getElementById('carbon-fact').textContent = data.carbon_fact;
        document.getElementById('education-info').textContent =
          data.education;

        const disposeButton = document.getElementById('dispose-button');
        if (data.recyclable === 'Tidak') {
          disposeButton.innerHTML = '<i class="fas fa-trash-alt"></i> <span>Temukan TPA Terdekat</span>';
        } else {
          disposeButton.innerHTML = '<i class="fas fa-recycle"></i> <span>Temukan Bank Sampah Terdekat</span>';
        }

      } else {
        mainElement.innerHTML = `<div class="text-center"><h1 class="font-lora text-3xl font-bold text-red-600">Error: Data Tidak Ditemukan</h1><p class="text-gray-600 mt-4">Maaf, kami tidak dapat menemukan informasi untuk jenis sampah '${wasteClass}'.</p><a href="scan.html" class="mt-8 inline-block px-6 py-3 bg-green-600 text-white rounded-lg">Coba Scan Lagi</a></div>`;
      }
    }
    async function getDynamicWasteData(wasteClass) {
      console.log(`Simulasi panggilan API Gemini untuk: ${wasteClass}`);
      const mockDatabase = {
        battery: {
          type: 'Baterai Bekas',
          confidence: '95%',
          recyclable: 'Ya, Limbah B3',
          carbon_fact: 'Daur ulang 1 ton baterai mengurangi 75% emisi karbon.',
          education:
            'Baterai mengandung logam berat berbahaya. Selalu buang di titik pengumpulan limbah elektronik khusus agar tidak mencemari tanah dan air.',
        },
        plastic: {
          type: 'Botol Plastik',
          confidence: '93%',
          recyclable: 'Ya (Jenis PET)',
          carbon_fact:
            'Daur ulang 1 ton plastik hemat energi setara 2.000 galon bensin.',
          education:
            'Plastik adalah ancaman besar bagi ekosistem laut. Pastikan botol dalam keadaan bersih dan remuk sebelum dibuang untuk menghemat ruang.',
        },
        cardboard: {
          type: 'Kardus',
          confidence: '99%',
          recyclable: 'Ya',
          carbon_fact:
            'Mendaur ulang 1 ton kardus dapat menyelamatkan sekitar 17 pohon.',
          education:
            'Kardus adalah salah satu material yang paling mudah didaur ulang. Pastikan dalam keadaan kering dan tidak terkontaminasi minyak.',
        },
        trash: {
          type: 'Sampah Residu',
          confidence: '90%',
          recyclable: 'Tidak',
          carbon_fact:
            'Sampah di TPA menghasilkan gas metana, 25x lebih merusak dari CO2.',
          education:
            'Ini adalah sampah sisa yang tidak bisa didaur ulang/dikompos. Contohnya popok bekas atau kemasan sachet. Tujuan kita adalah mengurangi produksi sampah jenis ini.',
        },
        // Tambahkan kelas lain dari model Anda
        metal: {
          type: 'Logam',
          confidence: '92%',
          recyclable: 'Ya',
          carbon_fact: 'Daur ulang aluminium menghemat 95% energi dibanding membuatnya dari baru.',
          education: 'Kaleng aluminium dan logam lainnya dapat didaur ulang berkali-kali tanpa kehilangan kualitas. Pastikan bersih sebelum dibuang.'
        },
        glass: {
          type: 'Kaca',
          confidence: '97%',
          recyclable: 'Ya',
          carbon_fact: 'Kaca 100% dapat didaur ulang dan tidak pernah terurai di TPA.',
          education: 'Botol dan toples kaca dapat didaur ulang. Pisahkan berdasarkan warna (jika diminta) dan pastikan tidak pecah.'
        },
        organic: {
          type: 'Organik',
          confidence: '94%',
          recyclable: 'Ya (Kompos)',
          carbon_fact: 'Mengompos sampah organik mengurangi emisi metana dari TPA.',
          education: 'Sampah sisa makanan dan kebun dapat diolah menjadi kompos yang menyuburkan tanah. Jangan campur dengan sampah lain.'
        },
        paper: {
          type: 'Kertas',
          confidence: '96%',
          recyclable: 'Ya',
          carbon_fact: 'Daur ulang 1 ton kertas selamatkan 17 pohon dan hemat 7.000 galon air.',
          education: 'Kertas seperti koran, majalah, dan HVS dapat didaur ulang. Hindari kertas yang kotor, berminyak, atau berlapis plastik/lilin.'
        }
      };

      // Simulasikan jeda jaringan
      await new Promise(resolve => setTimeout(resolve, 500));

      return mockDatabase[wasteClass.toLowerCase()] || null;
    }

  </script>
</body>

</html>